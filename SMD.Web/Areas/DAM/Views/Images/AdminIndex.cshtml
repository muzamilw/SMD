@{
    ViewBag.Title = "Manage Images";
    Layout = null;

}

@model SMD.MIS.Areas.DAM.Models.ImagesModel
<link href="~/content/dam/damsite.css" rel="stylesheet" />
<link href="~/Content/themes/Centaurus/css/bootstrap/bootstrap.min.css" rel="stylesheet" />

<section id="main" style="display:none;">
    <div class="row">
        <div class="row">
            <div class="col-sm-12" style="float: left; margin-bottom:20px;">
                <br />
               
                <div class="editor-row" style="">
                    <span style="font-size: 24px;" class="Theme_standard_clr">Free Image Gallery</span>
                    @*<div id="lblOr" >-OR-</div>*@
                    <button class="btn  btn-success " id="uploadFileMain" style="width:300px;margin-bottom:4px;    margin-left: 12px; float:right;">Upload an Image</button>
                </div>
             
                <br />
            </div>
        </div>
        <div class="row" style="padding-left:0px;min-height:400px;">
            <div class="pull-left damImgContainer" style="width:100%;overflow:auto;height:600px;overflow-x: hidden; ">
                @if (Model != null && Model.Images.Count > 0)
                {
                    <div class="imageContainer">
                        @foreach (var img in Model.Images)
                        {
                            <div class="imageBox" id="@img.ImageId" style="margin-left:2%;">
                                <img src="@img.ImageFileName" alt="Image" class="imagePreview" />
                                <input type="hidden" value="@img.ImageTitle" class="title" />

                                <div class="imageBoxName">
                                    <a class="" onclick="deletedImage(@img.ImageId)" style="float: right;">
                                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                    </a>
                                </div>

                            </div>

                        }
                    </div>
                }
                else
                {
                    <div class="imageCenter">
                        No images have been uploaded so far.
                    </div>
                }
            </div>
            <div class=" pull-left" style="width:63%">
              
                <div id="tabs-1">
                    @using (Html.BeginForm("UploadImageAdmin", "Images", FormMethod.Post, new { enctype = "multipart/form-data" }))
                    {
                        @Html.HiddenFor(model => model.X)
                        @Html.HiddenFor(model => model.Y)
                        @Html.HiddenFor(model => model.Width)
                        @Html.HiddenFor(model => model.Height)
                        @Html.HiddenFor(model => model.CompanyId)
                        @Html.HiddenFor(model => model.mode)
                        @Html.HiddenFor(model => model.bytes)
                        <div>
                          
                            <div class="image-editor">

                                <input type="file" class="cropit-image-input" style="display:none;">
                                <button class="btn  btn-info  export" id="changeCategory" style="width: 121px;"> Crop & Save</button>
                            </div>

                        </div>
                    }
                </div>



            </div>

        </div>

    </div>

</section>
<section id="loader">
    <img src="~/Content/DAM/Preloader_3.gif" style=" margin-top: 14%; margin-left: 44%;" />
</section>



@section Scripts{



}


<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="~/Content/DAM/jquery-ui.js"></script>
<link href="~/Content/DAM/jquery-ui.css" rel="stylesheet" />
<script src="~/Content/DAM/cropit.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<script>
    var aspectRatio = "2:1", minheight = 200, minWidth = 400;
    var imgDataUrl = "";
    $(window).load(function() {
        $("#main").css("display","block");
        $("#loader").css("display","none");
    });
    $(document).ready(function () { 
        $("#uploadFileMain").click(function () {
            $('.cropit-image-input').click();
            return false;
        });
        $(".cropit-image-input").change(function () {
            var data = new FormData();

            var files = $(".cropit-image-input").get(0).files;

            // Add the uploaded image content to the form data collection
            if (files.length > 0) {
                data.append("UploadedImage", files[0]);
            }

            // Make Ajax request with the contentType = false, and procesDate = false
            var ajaxRequest = $.ajax({
                type: "POST",
                url: "/DAMImages/UploadImageAdmin",
                contentType: false,
                processData: false,
                data: data
            });

            ajaxRequest.done(function (xhr, textStatus) {
                window.location.href = "/DAMImages/AdminIndex"
            });
        });

        
      
    });

    function showProgress() {

    }
    function hideProgress() {

    }
    function deletedImage(selectedImgId) {
        var r = confirm("Are you sure you want to delete this image?");
        if (r == true) {
            var model = {
                imageId: selectedImgId
            }
            var jsonObjects = JSON.stringify(model, null, 2);
            var to;
            to = "/DAMImages/DeleteImage/";
            var options = {
                type: "POST",
                url: to,
                data: jsonObjects,
                contentType: "application/json",
                async: true,
                success: function (response) {
                    window.location.href = "/DAMImages/AdminIndex"
                },
                error: function (msg) {
                    alert("Error occured "); console.log(msg);
                }
            };
            var returnText = $.ajax(options).responseText;
        } else {

        }

    }
    window.onload = function () {
        try {
            parent.iframeLoaded();
        } catch (e) {

        }

    }

</script>